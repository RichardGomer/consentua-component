<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-radio-button/paper-radio-button.html">
<link rel="import" href="../paper-radio-group/paper-radio-group.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-list/iron-list.html">


<dom-module id="consentua-component">
  <template>
    <style>
      :host {
        --consentua-main:#9A1144;
        --green-l:#4CAF50;
        --green-d:#265728;
        --primary-color:var(--green-l);
        width: 100%;
        height: 100%;
        display: block;
        background-color: #e1e1e1;
        padding: 1em 0em;
      }
      paper-button{
        background-color: var(--green-l);
        color: #fff;
        text-transform: capitalize;
        min-width: 22%;
      }
      paper-button[disabled]{
        background-color: var(--green-d);
      }
      .main-page{
      }
      .main-page > article{
            box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.35);
        height: 670px;
        padding: 1em;
        margin: 0em 1em;
        background: #fff;
        border-radius: 5px;
      }
      #pageControls{
        margin-top: 2em;
        display: flex;
        justify-content: space-around;
        align-items: center;
      }
      #binaryAllContain{
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      #binaryAllContain paper-toggle-button{
        align-self: flex-end;
        margin: 1em;
      }
      iron-list{
        height: 500px;
        overflow-y: auto;
        border-top: 2px solid #eee;
      }
      iron-list .item{
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #eee;
      }
      iron-list .item article{
        padding: 1em 0em;
      }
      iron-list .item paper-toggle-button{
        margin: 1em;
      }
      /*.tgl-binary, .tgl-binary-all{
        float: right;
      }*/
      .linear-page{
        display: flex;
      }
      .linear-page paper-radio-group{
        --paper-radio-group-item-padding: 0.7em auto;
            padding: 1em 0em 1em 2em;
      }
      .linear-page paper-radio-button{
        --paper-radio-button-size: 25px;
        --paper-radio-button-unchecked-background-color: #d6d6d6;
        --paper-radio-button-radio-container:{
          margin: 0px auto;
          border: 7px solid #d6d6d6;
          border-radius: 50%;
        };
      }
      .linear-page paper-radio-button[checked]:before{
        content: '';
        position: absolute;
        display: block;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 10px 20px 10px 0;
        border-color: transparent #ffffff transparent transparent;
        margin-left: 45px;
        margin-top: 8px;
      }
      .linear-page paper-radio-button:after{
        content: '';
        position: relative;
        display: block;
        background-color: #d6d6d6;
        width: 14px;
        height: 25px;
        left: 27%;
      }
      .linear-page paper-radio-button:nth-last-of-type(1):after{
        background-color: transparent;
      }
      /*.linear-page paper-radio-button:before{
        position: relative;
        display: block;
        content: '';
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background-color: #7e7e7e;
        top: 25px;
        left: 10px;
      }*/
      .linear-page > article{
        display:flex;
        flex-direction:column;
        flex: 1;
      }
      #pageLinear{
        flex: 1;
        border-top: 2px solid #eee;
        border-bottom: 2px solid #eee;
      }
      .linear-page .btn-setting{
        align-self: flex-start;
        width: 55%;
        margin: 1em 0px;
      }
      #branding{
        margin-top: 1em;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        font-size: 0.9em;
      }
      #branding img{
        background-color: var(--consentua-main);
        padding: 7px;
        max-height: 20px;
        margin: 0px 5px;
      }
    </style>
      <iron-ajax
         auto
         url="demo/template.json"
         handle-as="json"
         last-response="{{data}}"></iron-ajax>
      <iron-pages attr-for-selected="pageNo" selected="{{selectedMainPage}}" id="pageMain">
        <!-- Binary Consent -->
        <div class="main-page" pageNo="1">
          <article>
          <h2>[[binaryTemplate.Question]]</h2>
          <p>[[binaryTemplate.Explanation]]</p>
          <span id="binaryAllContain">
          <p>Allow all purposes</p>
          <paper-toggle-button class="tgl-binary-all" checked></paper-toggle-button>
          </span>
          <iron-list items="[[binaryPurposes]]" as="item">
            <template>
              <div class="item">
                <article>
                <h3>We will use</h3>
                [[item.DataUse]]
                <h3>For the purposes of</h3>
                [[item.DataPurpose]]
                </article>
                <paper-toggle-button class="tgl-binary" checked></paper-toggle-button>
              </div>
            </template>
          </iron-list>
          </article>
        </div>
        <!-- Linear Consent -->
        <div class="main-page linear-page" pageNo="2">
        <!-- page nav radio buttons -->
          <paper-radio-group attr-for-selected="name" selected="{{selectedLinearPage}}">
            <template is="dom-repeat" items="{{linearPurposes}}">
              <paper-radio-button noink name="[[index]]"></paper-radio-button><br>
            </template>
          </paper-radio-group>

          <article>
          <h2>[[linearTemplate.Question]]</h2>
          <p>[[linearTemplate.Explanation]]</p>
          <iron-pages selected="[[selectedLinearPage]]" id="pageLinear">
            <template is="dom-repeat" items="{{linearPurposes}}">
              <div>
              <h3>We will use</h3>
              <p>[[item.DataUse]]</p>

              <h3>For the purposes of</h3>
              <p>[[item.DataPurpose]]</p>
              </div>
            </template>
          </iron-pages>
          <paper-button class="btn-setting" raised>Use this setting</paper-button>
          </article>
        </div>
      </iron-pages>
      <div id="pageControls">
        <paper-button disabled id="btnPrev" raised on-tap="_pageBinary">Previous</paper-button>
        <span>[[selectedMainPage]]/2</span>
        <paper-button id="btnNext" raised on-tap="_pageLinear">Next</paper-button>
      </div>
      <span id="branding">
        Service provided by
        <img src="../img/consentua-logo-white.svg">
      </span>
  </template>

  <script>
    /**
     * `consentua-component`
     * consentua component
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class ConsentuaComponent extends Polymer.Element {
      static get is() { return 'consentua-component'; }
      static get properties() {
        return {
          data: {
            type: Object,
            notify: true
          },
          binaryPurposes:{
            type: Array,
            notify: true,
            computed: '_returnBinaryPurposes(data)'
          },
          linearPurposes:{
            type: Array,
            notify: true,
            computed: '_returnLinearPurposes(data)'
          },
          binaryTemplate:{
            type: Object,
            notify: true,
            computed: '_returnBinaryTemplate(data)'
          },
          linearTemplate:{
            type: Object,
            notify: true,
            computed: '_returnLinearTemplate(data)'
          },
          selectedMainPage:{
            type: Number,
            value: 1
          },
          selectedLinearPage:{
            type: Number,
            notify: true,
            value: 0
          }
        };
      }
      _returnBinaryPurposes(data){
        return data.Templates[0].PurposeGroups[0].Purposes;
      }
      _returnLinearPurposes(data){
        return data.Templates[1].PurposeGroups[0].Purposes;
      }
      _returnBinaryTemplate(data){
        return data.Templates[0];
      }
      _returnLinearTemplate(data){
        return data.Templates[1];
      }
      _pageBinary(e, selectedMainPage){
        this.selectedMainPage = 1;
        this._isDisabled(e.target);
      }
      _pageLinear(e, selectedMainPage){
        this.selectedMainPage = 2;
        this._isDisabled(e.target);
      }
      _isDisabled(e, selectedMainPage){
        if (!e.disabled) {
          this.$.btnPrev.disabled = false;
          this.$.btnNext.disabled = false;
          e.disabled = true;
        } else{
          console.log("how did you click this?");
        }
      }
      _pageSet1(selectedLinearPage){
        this.selectedLinearPage = 0;
      }
      _pageSet2(selectedLinearPage){
        this.selectedLinearPage = 1;
      }
      _pageSet3(selectedLinearPage){
        this.selectedLinearPage = 2;
      }
    }

    window.customElements.define(ConsentuaComponent.is, ConsentuaComponent);
  </script>
</dom-module>
