<link rel="import" href="../polymer/polymer-element.html">
<dom-module id="consentua-binary-selector">
  <template>
    <style>
      :host {
        display: block;
      }
      .main-page{
      }
      .main-page > article{
        box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.35);
        height: 670px;
        padding: 1em;
        margin: 0em 1em;
        background: #fff;
        border-radius: 5px;
      }
      .all-toggle-container{
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .all-toggle-container paper-toggle-button{
        align-self: flex-end;
        margin: 1em;
      }
      iron-list{
        height: 500px;
        overflow-y: auto;
        border-top: 2px solid #eee;
      }
      iron-list .item{
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #eee;
      }
      iron-list .item article{
        padding: 1em 0em;
      }
      iron-list .item paper-toggle-button{
        margin: 1em;
      }
    </style>
    <section>

    <!-- <template is="dom-repeat" items="[[purposeGroup]]"> -->
       <div class="main-page binary-page">
          <article>
            <h2>[[purposeGroup.Description]]</h2>
            <p>[[purposeGroup.Explanation]]</p>
            <span class="all-toggle-container">
            <p>Allow all purposes</p>
            <paper-toggle-button class="tgl-binary-all" checked></paper-toggle-button>
            </span>
              <iron-list items="[[purposeGroup.Purposes]]" as="item">
                <template>
                  <div class="item">
                    <article>
                    <h3>We will use</h3>
                    [[item.DataUse]]
                    <h3>For the purposes of</h3>
                    [[item.DataPurpose]]
                    </article>
                    <paper-toggle-button class="tgl-binary" checked="{{_getUserConsent(item)}}"></paper-toggle-button>
                  </div>
                </template>
              </iron-list>
          </article>
       </div>    
     <!-- </template> -->
      
    </section>
  </template>
  <script>
    class ConsentuaBinarySelector extends Polymer.Element {
      static get is() { return 'consentua-binary-selector'; }
      static get properties() {
        return {
          purposeGroup: {
            type: Object,
            notify: true,
            reflectToAttribute: true,
            value: {}
          },
          userConsents: {
            type: Object,
            reflectToAttribute: true,
            notify: true,
            value: {}
          }
        };
      }
      ready() {
        super.ready();
      }
      _getUserConsent(item){
        // if this purpose is the same as matching 1 in userConsents return t else f
        var arr = this.userConsents.Consent.Purpose;
        console.log("arr", arr);
        var isConsented = arr.find(function(findConsent){
          return findConsent.PurposeId === item.Id;
        });
        
        if(Array.isArray(arr)){
          console.log(isConsented);
          return isConsented;
        }
        
      }
    }

    // Associate the new class with an element name
    customElements.define(ConsentuaBinarySelector.is, ConsentuaBinarySelector);
  </script>
</dom-module>